################################################################### assume data has been read in, see read.r#### dumps data and runs JAGS for 1st preference daily track## generates picture summarizing Gibbs sampler output#### simon jackman, dept of political science## stanford university, october 2005#################################################################if(exists("foo"))  rm(foo)foo <- list()foo$y <- data$coalition/100var <- foo$y*(1-foo$y)/data$sampleSizefoo$prec <- 1/varfoo$date <- data$date - min(data$date) + 1foo$org <- data$orgfoo$NPOLLS <- length(data$y)foo$NPERIODS <- length(min(data$date):282)foo$alpha <- c(rep(NA,length((min(data$date)):282)-1),               .4047 + .0589 + .0034)  ## actual first preference on last day## write contents of object foo back to top level directoryfor(i in 1:length(foo))  assign(x=names(foo)[i],         value=foo[[i]])dump(list=names(foo))   ## dumprm(list=names(foo))     ## now clean-up## run jags job in batch modesystem("jags jags.cmd")## read JAGS output back into Rlibrary(coda)alphaFirst <- read.jags()houseFirst <- alphaFirst[,116:120]sigmaFirst <- alphaFirst[,115]alphaFirst <- alphaFirst[,1:114]alphaFirst.bar <- apply(alphaFirst,2,mean)alphaFirst.ci <- apply(alphaFirst,2,quantile,c(.025,.975))## get time stuff correctelectionDay <- julian(as.Date("2004-10-09"),                      origin=as.Date("2004-01-01"))dseq <- min(data$date):electionDaydateseq <- paste("2004-",                 c("07","08","09","10"),                 "-01",                 sep="")dateseq <- c(dateseq,"2004-10-09")datetcks <- julian(as.Date(dateseq),                   origin=as.Date("2004-01-01"))datelabs <- paste(c("July","Aug","Sep","Oct"),                  "1")datelabs <- c(datelabs,"Oct 9")## election announced 8/29## debate   9/12## lib poluct launch 9/26## labor policy launch 9/29eventTicks <- julian(as.Date(c("2004-08-29",                               "2004-09-09",                               "2004-09-12",                               "2004-09-26",                               "2004-09-29")),                     origin=as.Date("2004-01-01"))eventLabs <- c("Election\nAnnounced",               "Jakarta\nEmbassy\nBomb",               "Leader\nDebate",               "Lib Launch",               "ALP Launch")eventRotate <- c(0,0,rep(30,3))eventAdj <- list(c(.5,-.1),                 c(.5,-.1),                 c(-.1,.5),                 c(-.1,.5),                 c(-.1,.5))postscript(file="dailyFirst.ps",           paper="a4",           #height=8.5,width=11,           family=dinfamily)par(oma=c(.1,.1,3,.1),    mar=c(3,4,3,3),    las=1)xlocs <- jitter(data$date)plot(dseq,alphaFirst.bar,     type="n",     axes=F,     xlab="",     ylab=toupper("Coalition 1st Preferences (%)"),     xlim=c(min(data$date)-1,       electionDay),     ylim=c(.3675,.5025),     yaxs="i",     xaxs="i")axis(1,at=datetcks,labels=datelabs)axis(2,at=seq(from=.38,to=.50,by=.02),     labels=as.character(100*seq(.38,.50,by=.02)))axis(4,at=c(seq(from=.38,to=.50,by=.02),.467),     labels=c(as.character(100*seq(.38,.50,by=.02)),"46.7"))lastDay <- match(max(data$date),dseq)ok <- 1:lastDay##lines(dseq[ok],alphaFirst.ci[1,ok],lty=2)##lines(dseq[ok],alphaFirst.ci[2,ok],lty=2)polygon(x=c(dseq[ok],rev(dseq[ok])),        y=c(alphaFirst.ci[1,ok],rev(alphaFirst.ci[2,ok])),        border=F,        col=gray(.75))ok <- (lastDay):length(dseq)##polygon(x=c(dseq[ok],rev(dseq[ok])),##        y=c(alphaFirst.ci[1,ok],rev(alphaFirst.ci[2,ok])),##        border=F,##        col="pink")lines(dseq,alphaFirst.bar,lwd=3)#points(dseq,alphaFirst.bar,pch=16,cex=.5,col="white")## overlay eventspar(xpd=T)for(i in 1:length(eventTicks)){  lines(x=rep(eventTicks[i],2),        y=par()$usr[3:4],        lty=2)  text(x=eventTicks[i],       y=par()$usr[4],       eventLabs[i],       adj=eventAdj[[i]],       srt=eventRotate[i])}## now overlay poll datafor(i in 1:dim(data)[1]){  points(xlocs[i],data$coalition[i]/100,         pch=16,cex=1.45,col="black")  #lines(x=rep(xlocs[i],2),  #      y=c(data$lo[i],data$up[i]))}for(i in 1:dim(data)[1]){  text(xlocs[i],data$coalition[i]/100,       unclass(data$org)[i],cex=.75,col="white")}## text(x=par()$usr[1],##      y=par()$usr[4],##      adj=c(0,1.25),##      paste("computed on ",##            as.Date(Sys.time()),##            " \n",##            "with most recent poll fielded on ",##            data$start[order(data$date)[dim(data)[1]]],##            sep="")##      )## legend infoy0 <- .3975text(x=par()$usr[1]*.98 + par()$usr[2]*.02,     y=y0,     "Legend:",     adj=0)for(i in 1:5){    y0 <- y0 - .005    points(par()$usr[1]*.975 + par()$usr[2]*.025,           y=y0,           pch=16,col="black",cex=1.45)    text(par()$usr[1]*.975 + par()$usr[2]*.025,         y=y0,i,cex=.75,col="white")    text(par()$usr[1]*.955 + par()$usr[2]*.045,         y=y0,adj=0,levels(data$org)[i])}dev.off()system("epstopdf dailyFirst.ps")###################################################################################houseFirstEffects <- round(apply(houseFirst,2,                            function(x)c(mean(x),quantile(x,c(.025,.975))))*100,                      1)dimnames(houseFirstEffects)[[2]] <- levels(data$org)## summary statistics for averagehouseFirstSum <- apply(houseFirst,1,mean)mean(houseFirstSum)*100quantile(houseFirstSum,c(.025,.975))*100